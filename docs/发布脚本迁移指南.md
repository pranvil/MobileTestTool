# 发布脚本迁移指南

## 概述

发布脚本已统一为一个脚本 `scripts/release.ps1`，支持通过 `-Platform` 参数选择发布平台。所有配置统一从 `.release-config.ps1` 文件读取。

## 主要变更

1. **统一脚本**：`release-with-gitee.ps1` 和 `release-with-gitlab.ps1` 已删除，统一使用 `scripts/release.ps1`
2. **统一配置**：`.gitee-config.ps1` 和 `.gitlab-config.ps1` 合并为 `.release-config.ps1`
3. **平台选择**：通过 `-Platform` 参数选择发布平台（`all|github|gitee|gitlab`）

## 迁移步骤

### 第一步：创建统一配置文件

1. 在项目根目录创建 `.release-config.ps1`（可参考 `.release-config.ps1.example`）

2. 将现有配置合并到新文件：

   **如果您有 `.gitee-config.ps1`：**
   ```powershell
   # 复制 Gitee 配置
   $GiteeOwner = "pranvil"
   $GiteeRepo = "MobileTestTool"
   $GiteeToken = "your_gitee_token"
   ```

   **如果您有 `.gitlab-config.ps1`：**
   ```powershell
   # 复制 GitLab 配置
   $GitLabUrl = "http://10.129.93.67"
   $GitLabOwner = "hao.lin"
   $GitLabRepo = "mobiletesttool"
   $GitLabToken = "your_gitlab_token"
   ```

   **合并后的 `.release-config.ps1` 示例：**
   ```powershell
   # Gitee 配置
   $GiteeOwner = "pranvil"
   $GiteeRepo = "MobileTestTool"
   $GiteeToken = "your_gitee_token"

   # GitLab 配置
   $GitLabUrl = "http://10.129.93.67"
   $GitLabOwner = "hao.lin"
   $GitLabRepo = "mobiletesttool"
   $GitLabToken = "your_gitlab_token"
   ```

### 第二步：更新脚本调用方式

**旧方式（已废弃）：**
```powershell
# 旧方式 - 已删除
.\scripts\release-with-gitee.ps1 -Version "0.9.6.5.5"
.\scripts\release-with-gitlab.ps1 -Version "0.9.6.5.5"
```

**新方式：**
```powershell
# 发布到所有已配置的平台
.\scripts\release.ps1 -Version "0.9.6.5.5"

# 仅发布到 GitHub
.\scripts\release.ps1 -Version "0.9.6.5.5" -Platform github

# 仅发布到 Gitee
.\scripts\release.ps1 -Version "0.9.6.5.5" -Platform gitee

# 仅发布到 GitLab
.\scripts\release.ps1 -Version "0.9.6.5.5" -Platform gitlab
```

### 第三步：清理旧文件（可选）

旧配置文件可以删除（但建议先备份）：
- `.gitee-config.ps1`（已废弃）
- `.gitlab-config.ps1`（已废弃）

## 配置优先级

脚本按以下优先级加载配置：

1. **环境变量**（最高优先级）
   - `$env:GITEE_OWNER`, `$env:GITEE_REPO`, `$env:GITEE_TOKEN`
   - `$env:GITLAB_URL`, `$env:GITLAB_OWNER`, `$env:GITLAB_REPO`, `$env:GITLAB_TOKEN`

2. **`.release-config.ps1` 配置文件**（项目根目录）

## 使用示例

### 示例 1：发布到所有平台

```powershell
# 配置文件已包含所有平台的配置
.\scripts\release.ps1 -Version "0.9.6.5.5" -NotesFile "docs\notes.md"
```

### 示例 2：仅发布到 GitLab

```powershell
.\scripts\release.ps1 -Version "0.9.6.5.5" -Platform gitlab -NotesFile "docs\notes.md"
```

### 示例 3：仅发布到 Gitee

```powershell
.\scripts\release.ps1 -Version "0.9.6.5.5" -Platform gitee -NotesFile "docs\notes.md"
```

## 常见问题

### Q: 旧脚本还能用吗？

A: 不能。`release-with-gitee.ps1` 和 `release-with-gitlab.ps1` 已删除，请使用新的统一脚本。

### Q: 旧的配置文件还能用吗？

A: 不能。请将配置合并到 `.release-config.ps1` 文件中。

### Q: 如何同时发布到多个平台？

A: 使用 `-Platform all`（默认值），脚本会自动发布到所有已配置的平台。

### Q: 如果某个平台未配置会怎样？

A: 如果选择 `-Platform all`，未配置的平台会被跳过。如果明确指定某个平台但未配置，脚本会报错并提示配置方法。

## 更多信息

- 详细配置说明请参考 [README.md](../README.md) 中的"版本打包与发布脚本"部分
- GitLab 配置指南：[docs/GitLab发布配置指南.md](GitLab发布配置指南.md)
- Gitee 配置指南：[docs/Gitee发布配置指南.md](Gitee发布配置指南.md)

