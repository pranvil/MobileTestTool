# MobileTestTool 架构决策记录 (ADR)

## 文档信息

| 项目 | 内容 |
|------|------|
| **文档版本** | 1.0 |
| **创建日期** | 2025-11-03 |
| **最后更新** | 2025-11-03 |

---

## ADR模板说明

每个架构决策记录包含：
- **状态**：提议/已接受/已拒绝/已弃用
- **上下文**：决策的背景和原因
- **决策**：做出的决策
- **后果**：决策的影响

---

## ADR-001: 选择Python作为开发语言

**状态**：✅ 已接受  
**日期**：2025-11-03  
**决策者**：技术负责人

### 上下文

需要选择一种编程语言来开发桌面应用程序，要求：
- 跨平台支持（至少Windows）
- 丰富的库生态
- 开发效率高
- 易于维护

### 考虑的选项

1. **Python**
   - 优点：语法简洁、库丰富、开发效率高
   - 缺点：性能相对较低、打包后体积较大

2. **Java (JavaFX)**
   - 优点：跨平台好、性能较好
   - 缺点：需要JRE、开发复杂度较高

3. **C# (WPF)**
   - 优点：性能好、Windows原生支持
   - 缺点：跨平台差、Windows绑定

4. **Electron (JavaScript)**
   - 优点：跨平台、Web技术栈
   - 缺点：资源占用大、体积大

### 决策

选择**Python**作为开发语言，原因：
1. 开发效率高，快速迭代
2. 丰富的库支持（ADB、串口通信等）
3. 易于维护和扩展
4. 团队熟悉Python

### 后果

**积极影响**：
- 开发速度快
- 代码简洁易读
- 丰富的第三方库支持

**消极影响**：
- 性能相对较低（但对于桌面应用可接受）
- 打包后体积较大（需要优化）

**缓解措施**：
- 使用PyInstaller优化打包
- 性能关键部分使用C扩展（如需要）

---

## ADR-002: 选择PyQt5作为GUI框架

**状态**：✅ 已接受  
**日期**：2025-11-03  
**决策者**：技术负责人

### 上下文

需要在Python GUI框架中选择一个，要求：
- 功能强大
- 界面美观
- 文档完善
- 社区活跃

### 考虑的选项

1. **PyQt5**
   - 优点：功能强大、界面美观、文档完善
   - 缺点：商业使用需授权（GPL免费，商业需付费）

2. **PySide2/PySide6**
   - 优点：与PyQt类似，LGPL授权更友好
   - 缺点：文档相对较少、版本更新较慢

3. **Tkinter**
   - 优点：Python内置、免费
   - 缺点：界面较简陋、功能有限

4. **wxPython**
   - 优点：免费、原生外观
   - 缺点：文档较少、学习曲线陡

### 决策

选择**PyQt5**作为GUI框架，原因：
1. 功能强大，满足复杂UI需求
2. 界面美观，现代化设计
3. 文档完善，易于学习
4. 信号槽机制适合事件驱动开发

**授权说明**：项目采用GPL授权，符合PyQt5的GPL要求。

### 后果

**积极影响**：
- 能够快速实现复杂的UI功能
- 界面美观现代
- 开发效率高

**消极影响**：
- 如果未来需要商业授权，可能需要切换到PySide

**缓解措施**：
- 抽象UI层，便于未来切换框架
- 考虑未来迁移到PySide6

---

## ADR-003: 采用分层架构模式

**状态**：✅ 已接受  
**日期**：2025-11-03  
**决策者**：技术负责人

### 上下文

需要确定系统的架构模式，要求：
- 模块化清晰
- 便于维护
- 易于扩展

### 考虑的选项

1. **分层架构（Layered Architecture）**
   - 优点：层次清晰、职责明确、易于理解
   - 缺点：可能过度设计

2. **MVC模式**
   - 优点：模型视图分离
   - 缺点：对于桌面应用可能过于复杂

3. **MVP模式**
   - 优点：Presenter解耦View和Model
   - 缺点：增加复杂度

4. **微服务架构**
   - 优点：模块独立、可扩展
   - 缺点：对于桌面应用过度复杂

### 决策

采用**分层架构模式**，分为：
- 表现层（UI Layer）
- 业务逻辑层（Core Layer）
- 数据访问层（Data Access Layer）
- 外部接口层（External Layer）

### 后果

**积极影响**：
- 代码结构清晰
- 便于团队协作
- 易于维护和测试

**消极影响**：
- 可能需要更多的代码组织工作

---

## ADR-004: 使用管理器模式组织业务逻辑

**状态**：✅ 已接受  
**日期**：2025-11-03  
**决策者**：技术负责人

### 上下文

需要在业务逻辑层确定组织模式，要求：
- 功能模块化
- 资源管理清晰
- 便于测试

### 考虑的选项

1. **管理器模式（Manager Pattern）**
   - 每个功能领域一个Manager类
   - 统一管理资源生命周期

2. **服务模式（Service Pattern）**
   - 类似管理器模式
   - 更偏向业务服务

3. **领域驱动设计（DDD）**
   - 面向领域模型
   - 对于本项目可能过于复杂

### 决策

采用**管理器模式**，每个功能模块对应一个Manager类，如：
- `DeviceManager`：设备管理
- `LogProcessor`：日志处理
- `MTKLogManager`：MTKLOG管理

### 后果

**积极影响**：
- 职责清晰
- 便于管理资源
- 易于测试

**消极影响**：
- 可能需要更多的类

---

## ADR-005: 使用JSON作为配置文件格式

**状态**：✅ 已接受  
**日期**：2025-11-03  
**决策者**：技术负责人

### 上下文

需要选择配置文件的存储格式，要求：
- 人类可读
- 易于解析
- 支持复杂数据结构

### 考虑的选项

1. **JSON**
   - 优点：广泛支持、人类可读、易于解析
   - 缺点：不支持注释（可接受）

2. **YAML**
   - 优点：支持注释、更易读
   - 缺点：需要额外依赖、解析可能有问题

3. **XML**
   - 优点：结构清晰
   - 缺点：冗长、解析复杂

4. **INI**
   - 优点：简单
   - 缺点：不支持复杂结构

### 决策

使用**JSON**作为配置文件格式，原因：
1. Python内置支持，无需额外依赖
2. 人类可读
3. 支持复杂数据结构
4. 广泛使用，易于理解

### 后果

**积极影响**：
- 易于解析和生成
- 无需额外依赖
- 配置易于编辑

**消极影响**：
- 不支持注释（可通过文档解决）

---

## ADR-006: 使用PyInstaller打包应用

**状态**：✅ 已接受  
**日期**：2025-11-03  
**决策者**：技术负责人

### 上下文

需要将Python应用打包为可执行文件，要求：
- 单文件或单目录
- 包含所有依赖
- 易于分发

### 考虑的选项

1. **PyInstaller**
   - 优点：成熟稳定、支持单文件/目录、广泛使用
   - 缺点：体积较大

2. **cx_Freeze**
   - 优点：跨平台
   - 缺点：配置复杂、文档较少

3. **Nuitka**
   - 优点：编译为原生代码、性能好
   - 缺点：编译时间长、可能有问题

4. **py2exe**（仅Windows）
   - 优点：简单
   - 缺点：仅Windows、可能过时

### 决策

使用**PyInstaller**打包应用，原因：
1. 成熟稳定，广泛使用
2. 文档完善
3. 支持单文件和目录模式
4. 配置灵活

### 后果

**积极影响**：
- 打包简单
- 用户无需安装Python
- 分发方便

**消极影响**：
- 打包后体积较大
- 首次启动可能较慢

**缓解措施**：
- 优化依赖，移除不必要的库
- 使用单目录模式（onedir）而不是单文件

---

## ADR-007: 使用QThread实现异步操作

**状态**：✅ 已接受  
**日期**：2025-11-03  
**决策者**：技术负责人

### 上下文

需要处理长时间运行的操作，要求：
- 不阻塞UI
- 能够更新UI状态
- 易于使用

### 考虑的选项

1. **QThread（PyQt5）**
   - 优点：与PyQt5集成好、信号槽支持
   - 缺点：需要理解Qt线程模型

2. **threading（Python标准库）**
   - 优点：标准库、简单
   - 缺点：与PyQt集成需要额外工作

3. **asyncio**
   - 优点：异步编程模型
   - 缺点：与PyQt集成复杂

### 决策

使用**QThread**实现异步操作，原因：
1. 与PyQt5集成好
2. 信号槽机制便于UI更新
3. 线程安全

### 后果

**积极影响**：
- UI不阻塞
- 便于更新UI状态
- 与PyQt5集成好

**消极影响**：
- 需要理解Qt线程模型
- 需要注意线程安全

---

## ADR-008: 配置文件存储在用户目录

**状态**：✅ 已接受  
**日期**：2025-11-03  
**决策者**：技术负责人

### 上下文

需要确定配置文件存储位置，要求：
- 用户数据独立
- 便于备份
- 符合操作系统规范

### 考虑的选项

1. **用户目录（~/.netui/）**
   - 优点：符合OS规范、用户数据独立
   - 缺点：路径可能复杂

2. **应用目录**
   - 优点：简单
   - 缺点：可能没有写权限、打包后无法修改

3. **Windows注册表**
   - 优点：Windows标准
   - 缺点：跨平台问题、不易编辑

### 决策

配置文件存储在**用户目录**（`~/.netui/`），原因：
1. 符合操作系统规范
2. 用户数据独立，多用户支持
3. 便于备份
4. 打包后仍可修改配置

### 后果

**积极影响**：
- 符合OS规范
- 用户数据安全
- 便于备份和迁移

**消极影响**：
- 路径可能较复杂（可通过工具函数封装）

---

**文档状态**：✅ 持续更新中

