# 手机log辅助工具 v2.0

一个功能强大的Android设备日志管理和MTKLOG操作工具，支持实时日志过滤、MTKLOG管理、ADB Log操作和多设备支持。

## 🚀 功能特性

### 📱 日志过滤
- 🎯 **关键字过滤**: 支持普通文本和正则表达式过滤
- 🔤 **大小写敏感**: 可选择是否区分大小写
- 🌈 **彩色高亮**: 关键字高亮显示，便于快速定位
- 📜 **实时滚动**: 支持鼠标滚轮滚动浏览日志
- 💾 **日志保存**: 可将过滤后的日志保存为txt文件
- 📋 **复制功能**: 支持选择和复制日志内容
- ⚡ **实时过滤**: 实时显示过滤结果，无需等待

### 🔧 MTKLOG管理
- ▶️ **开启MTKLOG**: 完整的4步初始化序列（停止→清除→设置缓存→开启）
- ⏹️ **停止&导出**: 合并功能，停止logger并自动导出到本地
- 🗑️ **删除MTKLOG**: 清除设备上的MTKLOG日志
- 📁 **导出MTKLOG**: 单独导出MTKLOG到指定目录
- 🔄 **模式切换**: SD模式/USB模式切换

### 📊 ADB Log操作
- ▶️ **开启ADB Log**: 后台运行logcat进程
- 📤 **导出ADB Log**: 停止logcat并导出日志文件

### 🖥️ 多设备支持
- 📱 **设备选择**: 支持多设备连接时的设备选择
- 🔄 **设备刷新**: 实时检测连接的设备
- 🎯 **设备指定**: 所有操作都支持指定设备执行

### 📈 性能优化
- 📊 **性能监控**: 实时显示队列长度、处理速率、批次大小等指标
- ⚡ **自适应处理**: 根据负载自动调整处理参数
- 🎯 **智能裁剪**: 自动管理显示行数，防止内存溢出
- 🔄 **动态设置**: 可动态调整最大显示行数

## 🛠️ 系统要求

- Python 3.6+
- Android SDK (需要adb命令)
- Windows/Linux/macOS

## 📦 安装和使用

### 1. 环境准备
```bash
# 确保已安装Android SDK
# 下载并安装 Android SDK: https://developer.android.com/studio
# 将adb命令添加到系统PATH环境变量
```

### 2. 运行程序
```bash
# 直接运行Python脚本
python main.py

# 或使用打包好的可执行文件
.\dist\ADB_Logcat_Filter\ADB_Logcat_Filter.exe
```

### 3. 打包程序
```bash
# 使用批处理文件打包
.\build_onedir.bat
```

## 📖 使用说明

### 🎯 日志过滤
1. **连接设备**: 连接Android设备并启用USB调试
2. **选择设备**: 如果连接多个设备，从下拉框选择目标设备
3. **设置过滤**: 输入关键字，选择过滤选项
4. **开始过滤**: 点击"开始过滤"按钮
5. **保存日志**: 使用"保存日志"按钮保存过滤结果

### 🔧 MTKLOG操作
1. **开启MTKLOG**: 点击"开启"按钮，执行完整的初始化序列
2. **停止&导出**: 点击"停止&导出"按钮，停止logger并导出日志
3. **删除日志**: 点击"删除"按钮，清除设备上的MTKLOG
4. **模式切换**: 使用"SD模式"/"USB模式"按钮切换工作模式

### 📊 ADB Log操作
1. **开启ADB Log**: 点击"开启"按钮，启动后台logcat进程
2. **导出ADB Log**: 点击"导出"按钮，停止logcat并导出日志

### ⚙️ 高级设置
- **设置行数**: 动态调整最大显示行数（默认5000行）
- **性能监控**: 状态栏实时显示性能指标
- **设备管理**: 支持多设备连接和设备选择

## ⌨️ 快捷键

- **Ctrl+F**: 打开搜索对话框
- **F3**: 查找下一个匹配项
- **Shift+F3**: 查找上一个匹配项
- **Ctrl+Shift+L**: 显示主窗口
- **Escape**: 关闭搜索对话框
- **Enter**: 在关键字输入框中按Enter键快速开始过滤

## 🎛️ 界面布局

### 第一行（设备控制）
```
[设备:] [设备下拉框] [刷新设备] [MTKLOG:] [开启] [停止&导出] [删除] [SD模式] [USB模式] [ADB Log:] [开启] [导出]
```

### 第二行（过滤控制）
```
[关键字:] [输入框] [正则表达式] [区分大小写] [彩色高亮] [开始过滤/停止过滤] [清空日志] [清除缓存] [设置行数] [保存日志]
```

## ⚠️ 注意事项

- 确保Android设备已连接并启用USB调试模式
- 程序会自动限制显示行数以保持性能（默认5000行）
- 保存的日志文件使用UTF-8编码
- MTKLOG操作需要设备支持相应的logger服务
- 多设备操作时请确保选择正确的目标设备

## 🔧 故障排除

### 常见问题

1. **"未找到adb命令"错误**
   - 确保Android SDK已正确安装
   - 将adb命令路径添加到系统PATH环境变量

2. **设备未连接**
   - 检查USB连接
   - 确保设备已启用USB调试
   - 运行 `adb devices` 命令检查设备连接状态

3. **MTKLOG操作失败**
   - 确保设备支持MTKLOG服务
   - 检查设备权限设置
   - 尝试重新连接设备

4. **性能问题**
   - 调整最大显示行数设置
   - 检查系统资源使用情况
   - 关闭不必要的后台程序

## 🏗️ 技术实现

### 架构设计
- **模块化设计**: 将功能拆分为独立模块，便于维护和扩展
- **主入口**: `main.py` - 应用程序主入口和协调器
- **UI管理**: `ui_manager.py` - 用户界面和交互管理
- **设备管理**: `device_manager.py` - 设备连接和验证
- **MTKLOG管理**: `mtklog_manager.py` - MTKLOG相关操作
- **ADBLOG管理**: `adblog_manager.py` - ADB Log相关操作
- **日志处理**: `log_processor.py` - 日志过滤和性能优化
- **搜索管理**: `search_manager.py` - 搜索和高亮功能

### 技术栈
- **GUI框架**: tkinter
- **进程管理**: subprocess
- **多线程**: threading
- **正则表达式**: re
- **队列处理**: queue
- **性能优化**: 自适应批处理、智能裁剪、缓存机制

## 📝 更新日志

### v2.0 (当前版本)
- ✨ 新增MTKLOG管理功能
- ✨ 新增ADB Log操作功能
- ✨ 新增多设备支持
- ✨ 新增性能监控和优化
- ✨ 新增动态设置功能
- 🔧 优化用户界面布局
- 🔧 改进错误处理机制
- 🔧 统一确认弹框逻辑
- 🏗️ 重构为模块化架构
- 🔄 合并开始/停止过滤按钮
- 🎯 优化UI响应性和用户体验

### v1.0
- 🎯 基础日志过滤功能
- 🌈 关键字高亮显示
- 💾 日志保存功能
- ⌨️ 快捷键支持

## 📄 许可证

本项目采用MIT许可证。