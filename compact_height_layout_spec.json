{
  "spec_name": "CompactHeightNetworkInfoUI",
  "version": "1.0.0",
  "last_updated": "2025-09-20 16:56:21",
  "goal": "Make the network info table as short (vertical height) as possible without hurting readability.",
  "targets": {
    "modules": [
      "ui_manager.py",
      "network_info_manager.py"
    ],
    "widgets": [
      "ttk.Treeview (network table)",
      "containers: network_container, info_frame, network_info_frame"
    ]
  },
  "constraints": [
    "Must remain readable at typical laptop DPI (100–125%).",
    "Keep a single header row; do not hide RAT/SIM columns.",
    "No vertical stretch to fill the whole right panel; table height = rows * rowheight + header + small padding."
  ],
  "parameters": {
    "treeview": {
      "rows_visible": 5,
      "rowheight_px": 16,
      "font": [
        "Arial",
        9
      ],
      "heading_font": [
        "Arial",
        9,
        "bold"
      ],
      "horizontal_scrollbar": true,
      "zebra_stripes": false
    },
    "layout": {
      "label_frame_padding": 1,
      "container_fill": "x",
      "container_expand": false,
      "sticky": "WE",
      "outer_padding_px": {
        "x": 5,
        "y": 3
      }
    },
    "columns": {
      "SIM": {
        "width": 42,
        "anchor": "center"
      },
      "RAT": {
        "width": 42,
        "anchor": "center"
      },
      "Band": {
        "width": 50,
        "anchor": "center"
      },
      "CH": {
        "width": 64,
        "anchor": "center"
      },
      "PCI": {
        "width": 50,
        "anchor": "center"
      },
      "RSRP": {
        "width": 64,
        "anchor": "e"
      },
      "RSRQ": {
        "width": 64,
        "anchor": "e"
      },
      "SINR": {
        "width": 58,
        "anchor": "e"
      },
      "RSSI": {
        "width": 58,
        "anchor": "e"
      },
      "TA": {
        "width": 40,
        "anchor": "e"
      },
      "NOTE": {
        "width": 160,
        "anchor": "w",
        "stretch": true
      }
    }
  },
  "readability_guards": [
    "Ensure NOTE column stretches horizontally so important text (PLMN/CA/SSID) is visible.",
    "If window shrinks, enable horizontal scrollbar to avoid vertical wrap that increases height.",
    "Keep header font bold for visual separation at small rowheight."
  ],
  "behavioral_notes": [
    "This layout change does NOT affect refresh cadence (still controlled elsewhere).",
    "RRC idle/airplane/OOS suppression logic remains the same; only the table height/packing changes."
  ],
  "code_changes": {
    "ui_manager.py": {
      "network_container_pack": {
        "before": "network_container.pack(fill=tk.BOTH, expand=True, padx=5, pady=5)",
        "after": "network_container.pack(fill=tk.X, expand=False, padx=5, pady=3)"
      },
      "rowconfigure_weights": {
        "before": "network_container.rowconfigure(0, weight=1)",
        "after": "network_container.rowconfigure(0, weight=0)"
      },
      "info_frame": {
        "before": "info_frame = ttk.LabelFrame(network_container, text='网络信息', padding='2')",
        "after": "info_frame = ttk.LabelFrame(network_container, text='网络信息', padding='1')"
      },
      "network_info_frame_grid": {
        "before": "self.network_info_frame.grid(row=0, column=0, sticky=(tk.W, tk.E, tk.N, tk.S))",
        "after": "self.network_info_frame.grid(row=0, column=0, sticky=(tk.W, tk.E))"
      },
      "column_weight": {
        "note": "Allow horizontal stretch; no vertical stretch.",
        "set": [
          "network_container.columnconfigure(0, weight=1)",
          "info_frame.columnconfigure(0, weight=1)"
        ]
      }
    },
    "network_info_manager.py": {
      "treeview_style": {
        "configure": [
          "style.configure('Compact.Treeview', rowheight=16, font=('Arial', 9))",
          "style.configure('Compact.Treeview.Heading', font=('Arial', 9, 'bold'))"
        ]
      },
      "treeview_creation": {
        "before": "ttk.Treeview(..., height=6, style='Compact.Treeview')",
        "after": "ttk.Treeview(..., height=5, style='Compact.Treeview')"
      },
      "treeview_grid": {
        "before": "tree.grid(row=0, column=0, sticky=(tk.W, tk.E, tk.N, tk.S))",
        "after": "tree.grid(row=0, column=0, sticky=(tk.W, tk.E))"
      },
      "scrollbar": {
        "add_horizontal": [
          "hscroll = ttk.Scrollbar(self.app.ui.network_info_frame, orient='horizontal', command=tree.xview)",
          "tree.configure(xscrollcommand=hscroll.set)",
          "hscroll.grid(row=1, column=0, sticky=(tk.W, tk.E))"
        ]
      },
      "columns_setup": {
        "note": "Apply compact widths and anchors; set NOTE to stretch.",
        "apply": "for each column in parameters.columns set width/anchor; set NOTE stretch=True"
      }
    }
  },
  "height_estimation": {
    "rows": 5,
    "rowheight_px": 16,
    "header_px": 18,
    "padding_px": 8,
    "approx_total_px": 106
  },
  "verification": [
    "At runtime, log heights with winfo_height() for network_info_frame and tree after 200 ms.",
    "Ensure tree height stays near ~110–130px and does not grow with window height."
  ],
  "fallback": [
    "If small fonts look cramped on HiDPI, switch to rowheight=18, font size 10, and keep height=5."
  ]
}