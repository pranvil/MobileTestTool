# 自定义按钮功能完整指南

## 📋 功能概述

自定义按钮功能允许用户在打包成EXE后，自行添加多种类型的操作按钮，按钮会显示在指定的Tab和卡片中，点击后会执行自定义的操作，结果显示在日志区域。

## ✨ 主要特性

- ✅ **完全可视化配置** - 无需修改代码或配置文件
- ✅ **支持5种按钮类型** - ADB命令、Python脚本、文件操作、运行程序、系统命令
- ✅ **灵活的位置选择** - 可以选择任意Tab和卡片位置
- ✅ **命令安全验证** - 自动阻止持续输出命令（如logcat、tcpdump等）
- ✅ **实时预览** - 添加按钮时可预览完整命令
- ✅ **配置导入导出** - 支持备份和分享按钮配置
- ✅ **动态加载** - 修改配置后立即生效，无需重启程序

## 🚀 支持的按钮类型

### 1. 📱 **ADB命令**（原有功能）
- **用途**：执行Android设备相关命令
- **示例**：
  - `reboot` - 重启设备
  - `shell getprop ro.product.model` - 获取设备型号
  - `shell pm clear com.android.chrome` - 清除应用缓存

### 2. 🐍 **Python脚本**
- **用途**：执行自定义Python代码
- **安全限制**：只能使用安全的内置函数
- **示例**：
  ```python
  # 计算并显示系统信息
  import platform
  print(f"操作系统: {platform.system()}")
  print(f"Python版本: {platform.python_version()}")
  print(f"当前时间: {datetime.datetime.now()}")
  ```

### 3. 📁 **打开文件**
- **用途**：打开PC上的文件或文件夹
- **示例**：
  - `C:\Users\用户名\Desktop\文档.txt`
  - `C:\Users\用户名\Downloads`
  - `D:\项目文件\`

### 4. 🖥️ **运行程序**
- **用途**：启动PC上的程序
- **示例**：
  - `C:\Program Files\Notepad++\notepad++.exe`
  - `C:\Windows\System32\calc.exe`
  - `C:\Program Files\Google\Chrome\Application\chrome.exe`

### 5. 💻 **系统命令**
- **用途**：执行系统命令行指令
- **示例**：
  - `dir` - 列出当前目录文件（Windows）
  - `ls` - 列出当前目录文件（Linux/Mac）
  - `ipconfig` - 显示网络配置（Windows）

## 🎯 快速开始

### 1. 打开自定义按钮管理器

1. 启动程序
2. 切换到**"其他"**标签页
3. 在"其他操作"卡片中，点击 **"🔧 管理自定义按钮"** 按钮（绿色）

### 2. 添加第一个自定义按钮

点击 **"➕ 添加"** 按钮，在弹出的对话框中填写：

#### 示例1：查看设备存储空间
```
按钮名称：查看存储空间
按钮类型：ADB命令
命令/路径：shell df -h
所在Tab：其他
所在卡片：设备信息
描述：查看设备的存储空间使用情况
启用此按钮：✓
```

#### 示例2：系统信息收集（Python脚本）
```
按钮名称：系统信息收集
按钮类型：Python脚本
命令/路径：（在高级设置中输入）
所在Tab：其他
所在卡片：设备信息
描述：收集系统信息并显示
启用此按钮：✓
```

#### 示例3：快速打开项目文件夹
```
按钮名称：打开项目文件夹
按钮类型：打开文件
命令/路径：C:\Users\用户名\Documents\我的项目
所在Tab：其他
所在卡片：其他操作
描述：快速打开项目文件夹
启用此按钮：✓
```

### 3. 保存并查看效果

1. 点击 **"保存"** 按钮
2. 关闭对话框
3. 切换到相应的Tab，即可看到新添加的按钮
4. 选择设备后，点击自定义按钮即可执行命令

## 📍 可用的Tab和卡片位置

### Log控制 Tab
- MTK Log
- ADB Log
- Google Log
- Bugreport
- AEE Log
- TCPDUMP

### Log过滤 Tab
- Log过滤
- Log操作

### 网络信息 Tab
- 网络信息
- Ping测试

### TMO CC Tab
- 文件操作
- 过滤操作
- 服务器操作

### TMO Echolocate Tab
- Echolocate操作
- 日志过滤

### 24小时背景数据 Tab
- 手机配置
- 日志操作

### APP操作 Tab
- 包信息查询
- APK操作
- 应用管理

### 其他 Tab
- 设备信息
- 赫拉配置
- 其他操作
- Log操作

## ⚙️ 高级功能

### 编辑现有按钮

1. 在管理对话框中选择要编辑的按钮
2. 点击 **"✏️ 编辑"** 按钮
3. 修改信息后保存

### 删除按钮

1. 在管理对话框中选择要删除的按钮
2. 点击 **"🗑️ 删除"** 按钮
3. 确认删除

### 导出按钮配置

1. 点击 **"📤 导出"** 按钮
2. 选择保存位置
3. 保存为JSON文件（可分享给他人）

### 导入按钮配置

1. 点击 **"📥 导入"** 按钮
2. 选择JSON配置文件
3. 配置会合并到现有按钮中

## 🔒 命令安全限制

以下命令**不允许**添加（因为它们会持续输出，影响程序性能）：

| 命令 | 替代方案 |
|------|---------|
| `logcat` | 使用"Log过滤"功能 |
| `tcpdump` | 使用"Log控制"标签页的tcpdump功能 |
| `ping` | 使用"Network信息"标签页的ping功能 |
| `top` | 持续输出命令，不支持 |
| `getevent` | 持续输出命令，不支持 |
| `monkey` | 持续输出命令，不支持 |

## 💡 命令编写技巧

### 1. ADB命令 - 无需添加设备参数和"adb"前缀
程序会自动添加 `adb -s {设备ID}` 前缀，您只需要输入后面的部分。

**正确示例：**
```
shell getprop ro.build.version.release
reboot
shell df -h
```

**错误示例：**
```
adb -s 12345678 shell getprop ro.build.version.release  # 包含了设备和adb前缀
adb shell getprop ro.build.version.release              # 包含了adb前缀
```

**注意：** 如果您不小心输入了"adb"开头，程序会自动处理并去掉重复的"adb"前缀。

### 2. 常用ADB命令参考

#### 设备信息类
```bash
shell getprop                          # 查看所有系统属性
shell getprop ro.product.model         # 设备型号
shell getprop ro.build.version.release # Android版本
shell df -h                            # 存储空间
shell dumpsys battery                  # 电池信息
shell wm size                          # 屏幕分辨率
shell wm density                       # 屏幕密度
```

#### 应用管理类
```bash
shell pm list packages                 # 列出所有应用
shell pm clear com.example.app         # 清除应用数据
shell pm enable com.example.app        # 启用应用
shell pm disable com.example.app       # 禁用应用
shell am force-stop com.example.app    # 强制停止应用
```

#### 文件操作类
```bash
shell ls /sdcard/                      # 列出SD卡文件
shell rm /sdcard/test.txt              # 删除文件
shell mkdir /sdcard/test               # 创建目录
```

#### 系统设置类
```bash
shell settings put system screen_brightness 255  # 设置亮度
shell settings put system volume_music 10        # 设置音量
shell input keyevent 26                          # 按电源键
shell input text "Hello"                         # 输入文本
```

### 3. Python脚本示例

#### 示例1：系统信息收集
```python
import platform
import os
from datetime import datetime

print("=== 系统信息收集 ===")
print(f"操作系统: {platform.system()}")
print(f"系统版本: {platform.version()}")
print(f"处理器架构: {platform.machine()}")
print(f"Python版本: {platform.python_version()}")
print(f"当前用户: {os.getenv('USERNAME', 'Unknown')}")
print(f"当前目录: {os.getcwd()}")
print(f"当前时间: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}")
```

#### 示例2：数据处理
```python
import json
import math

# 模拟一些数据
data = {
    "设备数量": 5,
    "测试用例": [1, 2, 3, 4, 5],
    "成功率": 0.85
}

print("=== 数据处理示例 ===")
print(f"JSON数据: {json.dumps(data, ensure_ascii=False, indent=2)}")
print(f"测试用例总数: {len(data['测试用例'])}")
print(f"成功率百分比: {data['成功率'] * 100:.1f}%")
print(f"成功率平方根: {math.sqrt(data['成功率']):.3f}")
```

#### 示例3：数学计算
```python
import math

print("=== 数学计算示例 ===")
numbers = [1, 4, 9, 16, 25]

print("原数字:", numbers)
print("平方根:", [math.sqrt(n) for n in numbers])
print("自然对数:", [math.log(n) for n in numbers])
print("正弦值:", [math.sin(n) for n in numbers])

# 统计信息
print(f"总和: {sum(numbers)}")
print(f"平均值: {sum(numbers)/len(numbers):.2f}")
print(f"最大值: {max(numbers)}")
print(f"最小值: {min(numbers)}")
```

## 🎯 实用场景示例

### 场景1：测试工程师常用命令集

```json
[
  {
    "name": "清除所有应用数据",
    "command": "shell pm clear com.myapp",
    "tab": "APP操作",
    "card": "应用管理"
  },
  {
    "name": "查看内存使用",
    "command": "shell dumpsys meminfo",
    "tab": "其他",
    "card": "设备信息"
  },
  {
    "name": "截屏并查看",
    "command": "shell screencap -p /sdcard/screenshot.png",
    "tab": "其他",
    "card": "其他操作"
  }
]
```

### 场景2：开发调试快捷命令

```json
[
  {
    "name": "重启应用",
    "command": "shell am force-stop com.myapp && shell am start com.myapp/.MainActivity",
    "tab": "APP操作",
    "card": "应用管理"
  },
  {
    "name": "查看当前Activity",
    "command": "shell dumpsys activity top | findstr ACTIVITY",
    "tab": "APP操作",
    "card": "包信息查询"
  }
]
```

### 场景3：文件管理快捷操作

```json
[
  {
    "name": "打开项目文件夹",
    "type": "file",
    "path": "C:\\Users\\用户名\\Documents\\我的项目",
    "tab": "其他",
    "card": "其他操作"
  },
  {
    "name": "启动VS Code",
    "type": "program",
    "path": "C:\\Program Files\\Microsoft VS Code\\Code.exe",
    "tab": "其他",
    "card": "其他操作"
  }
]
```

## 📂 配置文件位置

自定义按钮配置保存在：
```
Windows: C:\Users\{用户名}\.netui\custom_buttons.json
```

可以手动编辑此文件，但建议使用管理界面操作。

## 🔄 配置迁移指南

### 升级前准备

当您收到新版本的MobileTestTool时，请按照以下步骤保存您的自定义按钮配置：

#### 方法1：使用程序内置功能（推荐）

**步骤1：备份当前配置**
1. 打开当前版本的MobileTestTool
2. 切换到**"其他"**标签页
3. 点击**"🔧 管理自定义按钮"**
4. 点击**"💾 备份"**按钮
5. 程序会自动创建备份文件：`C:\Users\{用户名}\.netui\custom_buttons_backup.json`

**步骤2：安装新版本**
1. 关闭当前程序
2. 安装新版本的MobileTestTool
3. 启动新版本程序

**步骤3：恢复配置**
1. 在新版本中切换到**"其他"**标签页
2. 点击**"🔧 管理自定义按钮"**
3. 点击**"📥 恢复"**按钮
4. 选择之前备份的文件：`custom_buttons_backup.json`
5. 确认恢复，所有自定义按钮将重新出现

#### 方法2：手动文件操作

**步骤1：找到配置文件**
配置文件位置：`C:\Users\{用户名}\.netui\custom_buttons.json`

**步骤2：复制配置文件**
1. 复制 `custom_buttons.json` 文件到安全位置（如桌面）
2. 重命名为 `custom_buttons_backup.json`

**步骤3：安装新版本**
1. 安装新版本程序
2. 将备份的配置文件复制到新位置：`C:\Users\{用户名}\.netui\custom_buttons.json`

#### 方法3：导出/导入功能

**步骤1：导出配置**
1. 在管理界面点击**"📤 导出"**
2. 选择保存位置（如桌面）
3. 文件名建议：`我的自定义按钮配置.json`

**步骤2：安装新版本后导入**
1. 在新版本中点击**"📥 导入"**
2. 选择之前导出的文件
3. 配置会自动合并到新版本中

## 🐛 故障排除

### 问题1：按钮不显示
**解决方案：**
1. 检查按钮是否启用（管理界面中有"✓"标记）
2. 确认Tab和卡片名称是否正确
3. 尝试重启程序

### 问题2：命令执行失败
**解决方案：**
1. 确认已选择设备
2. 检查命令语法是否正确
3. 在ADB命令行中手动测试命令
4. 查看日志区域的错误信息

### 问题3：命令被阻止
**解决方案：**
- 查看命令是否在黑名单中
- 使用程序提供的专门功能代替

### 问题4：Python脚本不工作
**解决方案：**
1. 检查脚本语法是否正确
2. 确认使用的模块是否在允许列表中
3. 查看日志区域的错误信息

### 问题5：文件操作失败
**解决方案：**
1. 确认文件路径是否存在
2. 检查文件权限
3. 确认程序路径是否正确

## ⚠️ 安全说明

### Python脚本安全限制
- 只能使用安全的内置函数
- 无法访问文件系统、网络等敏感操作
- 无法导入危险模块

### 系统命令限制
- 30秒执行超时限制
- 输出结果会在日志区域显示
- 建议使用安全的系统命令

### 文件操作
- 文件路径必须存在
- 程序路径必须是有效的可执行文件

## 📊 输出格式

### 成功执行
```
🔧 执行自定义按钮: 系统信息收集
✅ 执行成功
输出:
=== 系统信息收集 ===
操作系统: Windows
系统版本: 10.0.19042
处理器架构: AMD64
Python版本: 3.9.7
当前用户: hao.lin
当前目录: C:\Users\hao.lin\OneDrive\work\04 Code\Python Project\MobileTestTool
当前时间: 2024-12-01 15:30:45
```

### 执行错误
```
🔧 执行自定义按钮: 错误脚本
❌ 执行失败: Python脚本执行错误: name 'undefined_variable' is not defined
```

## 💡 最佳实践

### 1. 代码简洁
- 保持脚本简单明了
- 添加适当的注释
- 使用清晰的变量名

### 2. 错误处理
```python
try:
    # 你的代码
    result = some_operation()
    print(f"结果: {result}")
except Exception as e:
    print(f"错误: {e}")
```

### 3. 输出格式化
```python
# 使用格式化输出
print(f"设备ID: {device_id}")
print(f"测试结果: {result:.2f}%")
print(f"时间戳: {datetime.now():%Y-%m-%d %H:%M:%S}")
```

### 4. 定期备份
- 建议每次添加重要按钮后都进行备份
- 可以创建多个备份文件（按日期命名）

### 5. 配置分享
- 使用导出功能可以分享配置给团队成员
- 导出的文件包含完整的按钮信息

## 🔄 更新日志

### v1.0 (初始版本)
- ✅ 基础的自定义按钮功能
- ✅ 可视化配置界面
- ✅ 命令安全验证
- ✅ 配置导入导出
- ✅ 动态位置选择

### v1.1 (扩展版本)
- ✅ 新增Python脚本支持
- ✅ 新增文件操作支持
- ✅ 新增程序启动支持
- ✅ 新增系统命令支持
- ✅ 增强安全限制

## 📞 技术支持

如有问题或建议，请：
1. 查看日志文件：`logs/debug_*.txt`
2. 检查配置文件是否正确
3. 查看上方的"故障排除"部分
4. 联系开发团队

## ⚡ 性能提示

- 避免添加过多按钮（建议每个卡片不超过5个）
- 定期清理不常用的按钮
- 使用描述字段记录按钮用途，便于管理

---

**祝使用愉快！🎉**
