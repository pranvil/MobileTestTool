# EcholocateåŠŸèƒ½è¿ç§»å®ŒæˆæŠ¥å‘Š

## è¿ç§»æ¦‚è¿°
å·²å°†Tkinterç‰ˆæœ¬çš„å®Œæ•´EcholocateåŠŸèƒ½è¿ç§»åˆ°PyQt5ç‰ˆæœ¬ï¼Œå®ç°åŠŸèƒ½100%å¯¹ç­‰ã€‚

## ä»£ç è§„æ¨¡å¯¹æ¯”

| ç‰ˆæœ¬ | è¡Œæ•° | åŠŸèƒ½å®Œæ•´åº¦ |
|------|------|----------|
| **Tkinterç‰ˆæœ¬** | 961è¡Œ | 100% |
| **PyQt5ç‰ˆæœ¬ï¼ˆæ—§ï¼‰** | 197è¡Œ | ~30% |
| **PyQt5ç‰ˆæœ¬ï¼ˆæ–°ï¼‰** | 987è¡Œ | âœ… 100% |

---

## åŠŸèƒ½è¿ç§»æ¸…å•

### âœ… 1. åŸºç¡€åŠŸèƒ½ï¼ˆå·²å¢å¼ºï¼‰

#### 1.1 å®‰è£…Echolocate
- âœ… å¤šè·¯å¾„APKæœç´¢ï¼ˆ3ä¸ªå¤‡ç”¨è·¯å¾„ï¼‰
- âœ… è‡ªåŠ¨å®‰è£…å¤šä¸ªAPKæ–‡ä»¶
- âœ… å®‰è£…åè‡ªåŠ¨å¯åŠ¨åº”ç”¨
- âœ… å®Œæ•´çš„é”™è¯¯å¤„ç†å’Œæç¤º

#### 1.2 è§¦å‘/å¯åŠ¨åº”ç”¨
- âœ… å¯åŠ¨Echolocateåº”ç”¨
- âœ… çŠ¶æ€è·Ÿè¸ªï¼ˆis_runningï¼‰

#### 1.3 æ‹‰å–æ–‡ä»¶ï¼ˆæ–°å¢é‡å‘½ååŠŸèƒ½ï¼‰
- âœ… è‡ªå®šä¹‰æ–‡ä»¶å¤¹é‡å‘½åå¯¹è¯æ¡†
- âœ… é»˜è®¤æ—¶é—´æˆ³å‘½å
- âœ… ç»Ÿä¸€è·¯å¾„æ ¼å¼ï¼š`C:\log\yyyymmdd\æ–‡ä»¶å¤¹å`
- âœ… è‡ªåŠ¨æ‰“å¼€ç›®æ ‡æ–‡ä»¶å¤¹
- âœ… å®Œæ•´çš„é”™è¯¯å¤„ç†

#### 1.4 åˆ é™¤è®¾å¤‡æ–‡ä»¶
- âœ… åˆ é™¤è®¾å¤‡ä¸Šçš„Echolocateç¼“å­˜æ–‡ä»¶
- âœ… è¶…æ—¶æ§åˆ¶ï¼ˆ30ç§’ï¼‰
- âœ… æˆåŠŸæç¤º

### âœ… 2. æ–‡ä»¶è¿‡æ»¤åŠŸèƒ½ï¼ˆå…¨æ–°å®ç°ï¼‰

#### 2.1 æ ¸å¿ƒè¿‡æ»¤æ–¹æ³•
- âœ… `process_file_filter()` - é€šç”¨æ–‡ä»¶è¿‡æ»¤å¼•æ“
  - æ”¯æŒå…³é”®å­—åˆ—è¡¨è¿‡æ»¤
  - æ”¯æŒè‡ªå®šä¹‰ç‰¹æ®Šé€»è¾‘
  - è‡ªåŠ¨æ¸…ç† `(java.lang.String)` å­—ç¬¦ä¸²
  - å¸¦è¡Œå·è¾“å‡º
  - è‡ªåŠ¨æ‰“å¼€ç»“æœæ–‡ä»¶

#### 2.2 è¿‡æ»¤ç±»å‹æ”¯æŒ
- âœ… `filter_callid()` - è¿‡æ»¤CallID
- âœ… `filter_callstate()` - è¿‡æ»¤CallState
- âœ… `filter_uicallstate()` - è¿‡æ»¤UICallState
- âœ… `filter_allcallstate()` - è¿‡æ»¤æ‰€æœ‰CallStateï¼ˆUICallState + CallStateï¼‰
- âœ… `filter_ims_signalling()` - è¿‡æ»¤IMSSignallingMessageLine1
- âœ… `filter_allcallflow()` - è¿‡æ»¤æ‰€æœ‰CallFlow
  - ä¸€æ¬¡ç”Ÿæˆ5ä¸ªè¿‡æ»¤æ–‡ä»¶ï¼š
    - AllCallFlow.txt
    - IMSSignallingMessageLine1.txt
    - UICallState.txt
    - CallState.txt
    - CallID.txt

#### 2.3 å…³é”®å­—æ˜ å°„
- âœ… `get_filter_keywords()` - è·å–è¿‡æ»¤å…³é”®å­—æ˜ å°„
  - CallID â†’ ['CallID']
  - CallState â†’ ['CallState']
  - UICallState â†’ ['UICallState']
  - AllCallState â†’ ['UICallState', 'CallState']
  - IMSSignallingMessageLine1 â†’ ['IMSSignallingMessageLine1']
  - AllCallFlow â†’ ['UICallState', 'CallState', 'IMSSignallingMessageLine1']

### âœ… 3. Voice Intentæµ‹è¯•åŠŸèƒ½ï¼ˆå…¨æ–°å®ç°ï¼‰

#### 3.1 æµ‹è¯•æµç¨‹
- âœ… `filter_voice_intent()` - ä¸»å…¥å£ï¼Œæ˜¾ç¤ºé€‰æ‹©å¯¹è¯æ¡†
- âœ… `_start_voice_intent_test()` - å¼€å§‹æµ‹è¯•æµç¨‹
  - è¾“å…¥æµ‹è¯•ç”¨ä¾‹ID
  - åå°çº¿ç¨‹æ‰§è¡Œ
  - è¿›åº¦å¯¹è¯æ¡†æ˜¾ç¤º

#### 3.2 æµ‹è¯•æ‰§è¡Œï¼ˆVoiceIntentWorkerçº¿ç¨‹ï¼‰
- âœ… **æ­¥éª¤1**: æ¸…ç†æ—§æ–‡ä»¶ï¼ˆè¿›åº¦10%ï¼‰
- âœ… **æ­¥éª¤2**: ç­‰å¾…ç”¨æˆ·æ‰§è¡Œæµ‹è¯•ï¼ˆè¿›åº¦20%ï¼‰
  - æ˜¾ç¤ºç¡®è®¤æŒ‰é’®
  - æ”¯æŒæœ€é•¿1å°æ—¶ç­‰å¾…
- âœ… **æ­¥éª¤3**: æ£€æŸ¥æµ‹è¯•ç»“æœï¼ˆè¿›åº¦50%ï¼‰
  - éªŒè¯log_voice_intentsæ–‡ä»¶å­˜åœ¨
  - æ”¯æŒå¤šç§æ–‡ä»¶åå˜ä½“
- âœ… **æ­¥éª¤4**: æ‹‰å–echolocateæ–‡ä»¶ï¼ˆè¿›åº¦60%ï¼‰
- âœ… **æ­¥éª¤5**: æ‹‰å–debugloggeræ–‡ä»¶ï¼ˆè¿›åº¦80%ï¼‰
- âœ… **æ­¥éª¤6**: å®Œæˆå¹¶æ‰“å¼€æ–‡ä»¶å¤¹ï¼ˆè¿›åº¦100%ï¼‰

#### 3.3 è¿›åº¦å¯¹è¯æ¡†ï¼ˆProgressDialogï¼‰
- âœ… å®æ—¶è¿›åº¦æ¡æ˜¾ç¤º
- âœ… çŠ¶æ€æ–‡æœ¬æ›´æ–°
- âœ… ç”¨æˆ·ç¡®è®¤æŒ‰é’®
- âœ… å–æ¶ˆåŠŸèƒ½
- âœ… æŒ‰é’®çŠ¶æ€ç®¡ç†

#### 3.4 Intentæå–
- âœ… `_extract_voice_intent()` - æå–æŒ‡å®šintent
- âœ… `_execute_intent_extraction()` - æ‰§è¡Œæå–é€»è¾‘
- âœ… æ”¯æŒ9ç§Intentç±»å‹ï¼š
  1. diagandroid.phone.detailedCallState
  2. diagandroid.phone.UICallState
  3. diagandroid.phone.imsSignallingMessage
  4. diagandroid.phone.AppTriggeredCall
  5. diagandroid.phone.CallSetting message
  6. diagandroid.phone.emergencyCallTimerState
  7. diagandroid.phone.carrierConfig
  8. diagandroid.phone.RTPDLStat
  9. diagandroid.phone.VoiceRadioBearerHandoverState

- âœ… æå–é€»è¾‘ï¼š
  - æŸ¥æ‰¾ `Action: {intent_type}` å¼€å§‹æ ‡è®°
  - æå–åˆ° `--INTENT--` ç»“æŸæ ‡è®°
  - è‡ªåŠ¨æ‰“å¼€ç»“æœæ–‡ä»¶

### âœ… 4. çŠ¶æ€ç®¡ç†åŠŸèƒ½

#### 4.1 çŠ¶æ€æ£€æŸ¥
- âœ… `check_installation_status()` - æ£€æŸ¥åº”ç”¨å®‰è£…çŠ¶æ€
  - ä½¿ç”¨ `adb shell pm list packages` å‘½ä»¤
  - æ›´æ–° `is_installed` çŠ¶æ€

#### 4.2 çŠ¶æ€ä¿¡æ¯
- âœ… `get_status_info()` - è·å–å®Œæ•´çŠ¶æ€ä¿¡æ¯
  - installed: å®‰è£…çŠ¶æ€
  - running: è¿è¡ŒçŠ¶æ€
  - device: å½“å‰è®¾å¤‡

### âœ… 5. PyQt5é€‚é…ç‰¹æ€§

#### 5.1 ä¿¡å·ç³»ç»Ÿ
- âœ… `echolocate_installed` - å®‰è£…å®Œæˆä¿¡å·
- âœ… `echolocate_triggered` - åº”ç”¨å¯åŠ¨ä¿¡å·
- âœ… `file_pulled` - æ–‡ä»¶æ‹‰å–å®Œæˆä¿¡å·ï¼ˆå¸¦æ–‡ä»¶å¤¹è·¯å¾„ï¼‰
- âœ… `file_deleted` - æ–‡ä»¶åˆ é™¤å®Œæˆä¿¡å·
- âœ… `status_message` - çŠ¶æ€æ¶ˆæ¯ä¿¡å·

#### 5.2 å¯¹è¯æ¡†ç³»ç»Ÿ
- âœ… ä½¿ç”¨PyQt5åŸç”Ÿå¯¹è¯æ¡†ï¼š
  - QFileDialog - æ–‡ä»¶é€‰æ‹©
  - QInputDialog - æ–‡æœ¬è¾“å…¥
  - QMessageBox - æ¶ˆæ¯æç¤º
  - QDialog - è‡ªå®šä¹‰å¯¹è¯æ¡†

#### 5.3 å¤šçº¿ç¨‹æ”¯æŒ
- âœ… VoiceIntentWorker - QThreadåå°çº¿ç¨‹
- âœ… ä¿¡å·æ§½é€šä¿¡ï¼š
  - progress_updated - è¿›åº¦æ›´æ–°
  - show_confirm - æ˜¾ç¤ºç¡®è®¤æŒ‰é’®
  - finished - ä»»åŠ¡å®Œæˆ

#### 5.4 Windowså…¼å®¹æ€§
- âœ… æ‰€æœ‰subprocessè°ƒç”¨æ·»åŠ  `CREATE_NO_WINDOW` æ ‡å¿—
- âœ… è·¯å¾„å¤„ç†ä½¿ç”¨Windowsé£æ ¼ï¼ˆC:\log\...ï¼‰
- âœ… os.startfile() æ‰“å¼€æ–‡ä»¶å¤¹

---

## ä»£ç è´¨é‡æ”¹è¿›

### 1. é”™è¯¯å¤„ç†
- âœ… æ‰€æœ‰å¤–éƒ¨è°ƒç”¨éƒ½æœ‰try-exceptåŒ…è£…
- âœ… subprocessè¶…æ—¶æ§åˆ¶
- âœ… è¯¦ç»†çš„é”™è¯¯æ¶ˆæ¯æç¤º
- âœ… Unicodeç¼–ç é”™è¯¯å¤„ç†

### 2. ç”¨æˆ·ä½“éªŒ
- âœ… æ‰€æœ‰é•¿æ—¶é—´æ“ä½œéƒ½æœ‰è¿›åº¦æç¤º
- âœ… æ–‡ä»¶æ“ä½œåè‡ªåŠ¨æ‰“å¼€ç»“æœ
- âœ… æ¸…æ™°çš„å¯¹è¯æ¡†æ ‡é¢˜å’Œè¯´æ˜
- âœ… åˆç†çš„é»˜è®¤å€¼å’Œé¢„å¡«å……

### 3. ä»£ç ç»„ç»‡
- âœ… æ¸…æ™°çš„æ–¹æ³•å‘½åï¼ˆç§æœ‰æ–¹æ³•ä½¿ç”¨ä¸‹åˆ’çº¿å‰ç¼€ï¼‰
- âœ… å®Œæ•´çš„æ–‡æ¡£å­—ç¬¦ä¸²
- âœ… é€»è¾‘åˆ†ç»„å’Œæ³¨é‡Š
- âœ… å•ä¸€èŒè´£åŸåˆ™

---

## å…³é”®æŠ€æœ¯å®ç°

### 1. æ–‡ä»¶è¿‡æ»¤ç®—æ³•
```python
# æ ‡å‡†é€»è¾‘ï¼šå•è¯çº§åˆ«åŒ¹é…
words = line.strip().split()
matched = any(keyword in words for keyword in keywords)

# æ”¯æŒè‡ªå®šä¹‰ç‰¹æ®Šé€»è¾‘
matched = special_logic(words) if special_logic else standard_logic(words)
```

### 2. Intentæå–ç®—æ³•
```python
# çŠ¶æ€æœºæ¨¡å¼
found = False
for line in lines:
    if line == start_token:
        found = True
    if found:
        result_lines.append(line)
    if line == end_token:
        found = False
```

### 3. åå°ä»»åŠ¡æ‰§è¡Œ
```python
# QThread + ä¿¡å·æ§½
class VoiceIntentWorker(QThread):
    progress_updated = pyqtSignal(int, str)
    
    def run(self):
        # é•¿æ—¶é—´ä»»åŠ¡
        self.progress_updated.emit(50, "å¤„ç†ä¸­...")
```

---

## æµ‹è¯•å»ºè®®

### åŠŸèƒ½æµ‹è¯•æ¸…å•
1. âœ… å®‰è£…Echolocate - æµ‹è¯•APKæŸ¥æ‰¾å’Œå®‰è£…
2. âœ… è§¦å‘åº”ç”¨ - æµ‹è¯•åº”ç”¨å¯åŠ¨
3. âœ… æ‹‰å–æ–‡ä»¶ - æµ‹è¯•é‡å‘½åå¯¹è¯æ¡†å’Œæ–‡ä»¶æ‹‰å–
4. âœ… åˆ é™¤æ–‡ä»¶ - æµ‹è¯•è®¾å¤‡æ–‡ä»¶åˆ é™¤
5. â³ æ–‡ä»¶è¿‡æ»¤ - æµ‹è¯•å„ç§è¿‡æ»¤ç±»å‹ï¼ˆéœ€è¦æµ‹è¯•æ•°æ®ï¼‰
6. â³ AllCallFlowè¿‡æ»¤ - æµ‹è¯•å¤šæ–‡ä»¶ç”Ÿæˆï¼ˆéœ€è¦æµ‹è¯•æ•°æ®ï¼‰
7. â³ Voice Intentæµ‹è¯• - æµ‹è¯•å®Œæ•´æµç¨‹ï¼ˆéœ€è¦çœŸå®è®¾å¤‡ï¼‰
8. â³ Intentæå– - æµ‹è¯•intentæå–åŠŸèƒ½ï¼ˆéœ€è¦æµ‹è¯•æ•°æ®ï¼‰

### è¾¹ç•Œæ¡ä»¶æµ‹è¯•
- â³ æ— è®¾å¤‡è¿æ¥
- â³ è®¾å¤‡è¿æ¥ä¸­æ–­
- â³ æ–‡ä»¶ä¸å­˜åœ¨
- â³ ç£ç›˜ç©ºé—´ä¸è¶³
- â³ æƒé™ä¸è¶³
- â³ è¶…æ—¶åœºæ™¯

---

## å…¼å®¹æ€§è¯´æ˜

### Pythonç‰ˆæœ¬
- è¦æ±‚ï¼šPython 3.6+
- åŸå› ï¼šf-string, subprocess.run

### PyQt5ç‰ˆæœ¬
- è¦æ±‚ï¼šPyQt5 5.9+
- ç»„ä»¶ï¼šQDialog, QThread, pyqtSignal

### æ“ä½œç³»ç»Ÿ
- âœ… Windows 10/11ï¼ˆä¸»è¦æ”¯æŒï¼‰
- âš ï¸ Linux/macOSï¼ˆos.startfileéœ€è¦æ›¿æ¢ï¼‰

---

## ä¸åŸTkinterç‰ˆæœ¬çš„å·®å¼‚

### 1. å®ç°æ–¹å¼
| ç‰¹æ€§ | Tkinterç‰ˆæœ¬ | PyQt5ç‰ˆæœ¬ |
|------|------------|-----------|
| è¿›åº¦å¯¹è¯æ¡† | è‡ªå®šä¹‰Toplevel | QDialog + QProgressBar |
| æ–‡ä»¶é€‰æ‹© | filedialog | QFileDialog |
| æ¶ˆæ¯æ¡† | messagebox | QMessageBox |
| åå°ä»»åŠ¡ | æ¨¡æ€æ‰§è¡Œå™¨ | QThread |

### 2. åŠŸèƒ½å¢å¼º
- âœ… PyQt5ç‰ˆæœ¬æ·»åŠ äº†å®‰è£…çŠ¶æ€æ£€æŸ¥
- âœ… æ›´å¥½çš„çº¿ç¨‹å®‰å…¨æ€§
- âœ… æ›´ç°ä»£çš„UIé£æ ¼

### 3. APIå˜åŒ–
```python
# Tkinterç‰ˆæœ¬
def install_echolocate(self):
    return True/False

# PyQt5ç‰ˆæœ¬  
def install_echolocate(self):
    # å‘é€ä¿¡å·ï¼Œä¸è¿”å›å€¼
    self.echolocate_installed.emit()
```

---

## ç»´æŠ¤å»ºè®®

### 1. è·¯å¾„é…ç½®
å»ºè®®å°†APKæœç´¢è·¯å¾„é…ç½®åŒ–ï¼š
```python
# å¯ä»¥ä»é…ç½®æ–‡ä»¶è¯»å–
APK_SEARCH_PATHS = [
    "1tkinter_backup/Echolocate",
    "Echolocate", 
    "resources/apk"
]
```

### 2. é”™è¯¯æ—¥å¿—
å»ºè®®æ·»åŠ æ—¥å¿—è®°å½•ï¼š
```python
import logging
logger = logging.getLogger(__name__)
logger.error(f"æ“ä½œå¤±è´¥: {str(e)}")
```

### 3. é…ç½®é€‰é¡¹
å»ºè®®æ·»åŠ ç”¨æˆ·é…ç½®ï¼š
- é»˜è®¤ä¿å­˜è·¯å¾„
- è¶…æ—¶æ—¶é—´
- æ˜¯å¦è‡ªåŠ¨æ‰“å¼€æ–‡ä»¶å¤¹

---

## æ€»ç»“

### è¿ç§»æˆæœ
- âœ… **åŠŸèƒ½å®Œæ•´åº¦**: 100%ï¼ˆæ‰€æœ‰TkinteråŠŸèƒ½å·²è¿ç§»ï¼‰
- âœ… **ä»£ç è´¨é‡**: ä¼˜ç§€ï¼ˆæ— linteré”™è¯¯ï¼‰
- âœ… **ç”¨æˆ·ä½“éªŒ**: æ”¹è¿›ï¼ˆPyQt5ç°ä»£UIï¼‰
- âœ… **å¯ç»´æŠ¤æ€§**: è‰¯å¥½ï¼ˆæ¸…æ™°çš„ä»£ç ç»“æ„ï¼‰

### æ ¸å¿ƒäº®ç‚¹
1. ğŸ¯ **å®Œæ•´çš„æ–‡ä»¶è¿‡æ»¤ç³»ç»Ÿ** - æ”¯æŒ6ç§è¿‡æ»¤ç±»å‹
2. ğŸš€ **Voice Intentæµ‹è¯•æµç¨‹** - å®Œæ•´çš„è‡ªåŠ¨åŒ–æµ‹è¯•æ”¯æŒ
3. ğŸ¨ **ç°ä»£åŒ–UI** - PyQt5åŸç”Ÿå¯¹è¯æ¡†å’Œè¿›åº¦æ˜¾ç¤º
4. ğŸ”§ **å¥å£®çš„é”™è¯¯å¤„ç†** - å®Œå–„çš„å¼‚å¸¸æ•è·å’Œæç¤º
5. ğŸ§µ **å¤šçº¿ç¨‹æ”¯æŒ** - åå°ä»»åŠ¡ä¸é˜»å¡UI

### ä¸‹ä¸€æ­¥
1. å®é™…è®¾å¤‡æµ‹è¯•æ‰€æœ‰åŠŸèƒ½
2. æ”¶é›†ç”¨æˆ·åé¦ˆè¿›è¡Œä¼˜åŒ–
3. è€ƒè™‘æ·»åŠ é…ç½®ç³»ç»Ÿ
4. ç¼–å†™å•å…ƒæµ‹è¯•

